# 更新日志

所有显著的变更都会记录在此文档中。此项目遵循 [语义化版本控制](https://semver.org/spec/v2.0.0.html)。

## [2.3.12] - 2025-08-01

### 优化
- 优化“豆瓣想看”数据获取逻辑，当本地数据库与豆瓣网的电影和电视剧标题不一致时自动更新本地标题。
- 优化“豆瓣想看”数据获取逻辑，当本地数据库与豆瓣网的电视剧集数不一致时自动更新本地集数信息。
- 优化“正在订阅”服务，当本地数据库与豆瓣网的电影和电视剧标题不一致时自动更新本地标题。
- 优化“正在订阅”服务，支持电视剧总集数随豆瓣网新获取的集数信息同步更新。
- 优化“正在订阅”服务，支持热门推荐(TMDB)中订阅的电影和剧集在标题、集数变化时更新数据库记录。
- 优化“扫描媒体库”服务，当已完整入库的电视剧本地文件缺失时同步更新数据库集数。
- 优化站点索引程序的标题匹配策略，改为全匹配以解决相似标题无法正确匹配的问题。
- 优化主程序Chrome进程监控，改进僵尸进程检测和处理逻辑，避免异常抛出。
- 优化内置谷歌浏览器缓存自动清理，在程序启动初始化检查时检测并清理浏览器缓存目录。
- 优化“热门推荐”数据获取逻辑，当TMDB API密钥无效或网络异常时显示错误提示。
- 优化“订阅检索下载”服务，调整及优化种子下载匹配处理逻辑，提升种子下载成功率。

### 文档
- “使用帮助及常见问题”中增加“手动清除内置浏览器缓存数据”说明及清除步骤。

## [2.3.11] - 2025-07-25

### 优化
- 优化“更新媒体添加时间”服务组件，增加对于NFO文件中发行年份的检查，检查年份是否为 0001，如果为0001则判断为无效年份，跳过更新媒体添加时间。
- 优化资源索引程序对于站点URL访问失败时的处理逻辑，避免因站点访问失败导致程序异常崩溃的问题。
- 优化“不太灵影视”站点索引程序，支持多页搜索结果遍历，可获取到更多资源。
- 优化“BT影视”站点索引程序，支持资源类型判断，对于相同标题和年份的资源会进行类型判断，避免电影被当成剧集或剧集被当成电影。

## [2.3.10] - 2025-07-18

### 修复
- 修复某些情况下Chrome驱动、Chrome浏览器相关进程未正常结束持续在后台运行，导致需要使用Chrome驱动、Chrome浏览器的程序在运行时无法初始化报程序运行发生错误的问题。主程序中增加对Chrome驱动、Chrome浏览器相关进程的监控和检测，当Chrome驱动、Chrome浏览器相关进程超过20分钟未正常结束时，将尝试自动结束相关进程。
- 修复“更新媒体添加时间”服务组件遇到不支持的NFO文件编码导致程序异常崩溃的问题。添加常见编码支持以及不支持的编码异常处理逻辑。

## [2.3.9] - 2025-07-11

### 致谢
- 感谢“什么值得买”社区值友：sunny_dunn 指出部署文档中存在的错误；安装部署文档现已修正。

### 新增
- 新增“刮削媒体元数据服务”开启后可以进行媒体库元数据刮削并保存至媒体库NFO文件中。详细介绍请查看：[配置文档](http://wiki.songmy.top:8080/web/#/686311457/102215717)

### 修复
- 修复Bing API接口失效导致默认图片和登录页面背景图片加载失败的问题。改为使用：[Bing每日壁纸档案库](https://bing.img.run/)提供的开放API接口。

## [2.3.8] - 2025-07-04

### 碎碎念
- 又到周五了，即将迎来愉快的周末，同时也迎来了本次的功能更新。祝大家周末愉快！
- 今后常规型升级更新将固定在周五进行推送；紧急修复型更新依然保持动态进行推送。

### 新增
- 新增“站点索引开关”选项，可根据实际使用情况开启或关闭某些站点。（关闭不常用站点后可提升资源搜索速度）
- 新增“剧集关联功能”。详细介绍请查看：[配置文档](http://wiki.songmy.top:8080/web/#/686311457/102215715)
- 新增公开资源站点：[BT影视](https://www.btbtl.com)

## [2.3.7] - 2025-06-27

### 致谢
- 感谢飞牛私有云论坛网友@Corei7

### 优化
- 优化“下载目录监控服务”剧集文件名解析规则，支持识别“第1集”、“第01集”、“01集”、“1集”等格式的中文集数信息剧集文件名。以及英文集数信息支持不区分大小写
- 优化“下载目录监控服务”对于多季剧集的TMDB API查询判断，如本地解析年份与TMDB年份不一致，则使用TMDB年份并尝试获取剧集季信息。
- 优化“下载目录监控服务”对于电影、剧集中文名称的解析规则。
- 优化“下载目录监控服务”查询TMDB API时，如果首选语言zh-CN没找到标题匹配，则尝试用备选语言zh-SG再查一次。
- 优化系统设置项：“中文演职人员”选项添加开关，默认为关闭。（中文演职人员功能仅针对于依赖媒体库中NFO元数据文件展示的演员信息，开启后会尝试将NFO元数据文件中的演职人员名称替换为中文演员名称）

### 修复
- 修复“扫描媒体库”服务在极少数情况下因数据库中电视剧的集数字段为整数类型未被转为字符串类型导致的“扫描媒体库”服务异常错误的问题。

## [2.3.6] - 2025-06-23

### 说明
- 本次更新主要修复 [2.3.5](https://github.com/smysong/mediamaster-v2/releases/tag/v2.3.5) 版本中存在的问题。

### 引用变更
- 参考 [2.3.5 更新日志](https://github.com/smysong/mediamaster-v2/releases/tag/v2.3.5) 中提到的功能改进和错误修复。

### 优化
- 优化下载管理页面当任务列表为空时显示“当前暂无下载任务”提示。
- 优化“下载目录监控服务”对于电视节目重命名时季编号自动补零。（例如S1补零S01）
- 优化“下载目录监控服务”通过标题查询TMDB API获取年份信息。
- 优化“下载目录监控服务”对于年份信息提取不准确的问题。（例如文件名没有年份信息，错误的将1080p中的1080当作年份）
- 优化正在订阅列表对于已入库电视节目缺失集数的检查逻辑。

##  [2.3.5] - 2025-06-16

### 新增
- 新增qbittorrent和transmission下载器使用api接口直接添加下载任务，自动化程序在检索并下载种子后会自动添加到下载器中开始下载。（无需配置下载器监听torrent目录，如需使用请将下载器种子监听功能关闭。为保障兼容性，推荐使用qBittorrent v5.0.0 以及transmission v4.0.0  以上版本）
- “热门推荐”新增搜索功能，支持搜索TMDB中的电影和剧集信息，并快捷添加到订阅中。
- 新增“下载目录监控服务”识别失败的文件直接转移到未识别文件夹中。

### 修改
- 修改tmdb图片获取接口为tmdb官方接口（image.tmdb.org）若您无法正确加载“热门推荐”、“媒体库”中海报图片，请检查本地网络与image.tmdb.org的连通性。

### 优化
- 优化chromedriver忽略ssl证书验证，避免因站点证书过期导致无法访问站点的问题。
- 优化“不太灵影视”可能出现多次验证码导致无法检索到有效资源或下载种子失败的情况。
- 优化“下载目录监控服务”使用qbittorrent和transmission下载器时基于创建任务时的标签信息进行匹配，提高文件转移识别成功率和准确率。
- 优化对于“01.mp4、02.mp4”类似文件名的匹配，将识别为集数，再通过文件夹名称提取剧集标题等信息，如用户下载到类似的文件夹结构，则只需要重命名文件夹即可识别。例如：黄雀-S1-2025、黄雀-2025、黄雀2025 。
- 优化自动下载删除任务服务：增加下载任务状态的判断，下载任务做种以及下载状态为“已完成”，并且进度为100%则删除该任务。
- 优化正在订阅关联性，原正在订阅列表只有成功入库才会更新。现改为种子文件下载并添加下载任务后就进行更新，并且保留原成功入库更新。
- 优化系统设置页面，隐藏非必要选项以及动态变化选项。
- 优化“在线升级”功能API接口服务，提供代理服务，提高在线升级成功率。
- 一些其他修复和优化。

### 修复
- 修复“媒体库”、“热门推荐”页面中图片加载超时或加载失败时未正确显示默认图片的问题。

## [2.3.4] - 2025-06-03

### 说明
- 本次更新主要修复[2.3.3] - 2025-05-30 更新所带来的问题，建议版本号为[2.3.3]的用户及时安装更新。

### 优化
- 优化扫描媒体库时对于电视剧“季”年份的处理逻辑。

### 修复
- 修复获取“豆瓣想看”数据时，电影episode字段为空导致程序错误的将电影当作集数无效的电视剧进行跳过处理的问题。（该问题影响获取电影订阅，受影响版本：v2.3.3）

## [2.3.3] - 2025-05-30

### 修复
- 修复检查正在订阅时，遇到电视剧总集数为“unknow”等非法值导致程序崩溃的问题，现遇到无效集数会自动跳过该条目。
- 修复获取“豆瓣想看”数据时，遇到集数为空或“unknow”等无效数据时自动跳过该项目，避免后续处理异常。

### 优化
- 优化 Dockerfile，合并所有 apt-get 操作，减少镜像层数和重复请求，提高构建效率。

## [2.3.2] - 2025-05-29

### 优化
- 优化下载目录监控服务：处理文件时忽略特定后缀文件（'.cfg', '.txt', '.pdf','.doc','.docx', '.html'）。
- 优化媒体文件添加时间更新服务的日志输出。

## [2.3.1] - 2025-05-26

### 修复
- 修复全新部署时，下载管理默认端口为“port”参数，导致程序异常退出的问题。

### 优化
- 优化豆瓣接口查询详细信息时部分媒体名称中包含特殊符号时，无法正确查询到详细信息的问题。

## [2.3.0] - 2025-05-23

### 说明
- 本次更新涉及python依赖库安装，安装速度与成功率取决于本地网络环境，如多次尝试在线升级失败，请拉取最新Docker镜像进行更新。

### 新增
- 新增下载器：“迅雷”，支持调用迅雷-远程设备进行下载。（可通过菜单栏点击“版本号”，在窗口中点击“使用帮助”链接访问配置文档）
- 新增使用帮助和问题反馈渠道。可通过点击左下角“版本号”弹出程序信息，点击“使用帮助”链接访问配置文档，在配置文档页面中通过问题反馈渠道进行反馈。

### 优化
- 优化全集匹配策略，当缺失的剧集发现全集资源时将优先下载全集资源，使用全集资源覆盖媒体库中现有的剧集文件，实现洗版。避免在追剧时某些集音频和视频质量不统一导致观影体验不佳。（例如每集音量大小不一导致声音忽大忽小、视频清晰度忽高忽低）
- 优化系统仪表中“系统进程”模块运行时长的计算逻辑，超过24小时，将显示为“天”+“小时”。
- 优化下载目录监控服务：文件转移时提取视频质量的处理逻辑，统一视频质量后缀为p（逐行扫描）例如：1080p、2160p。默认忽略：迅雷云盘缓存目录、以点（.）开头的隐藏文件和目录、小于5MB的文件。

## [2.2.4] - 2025-05-19

### 修复
- 修复“观影”站点建立索引失败的问题（站点策略更新需要登录后才有权限进行搜索、下载等操作）。

## [2.2.3] - 2025-05-16

### 说明
- 修复较为严重的BUG，在特定情况下该BUG会引起程序崩溃无法使用，建议所有用户安装更新。可通过在线更新或拉取最新Docker镜像更新。

### 修复
- 修复检查订阅时，如果已入库的剧集只有1集时，程序读取的数据是整数而不是字符串，导致程序异常崩溃的问题。
- 修复进入“电视剧”库时，如果已入库剧集存在只有1集的情况时页面显示服务器错误，无法进入电视剧库的问题。

### 优化
- 优化下载管理页面下载任务状态解析，更新常用状态及对应文字提示。

## [2.2.2] - 2025-05-15

### 修复
- 扫描媒体库时，媒体文件标题与NFO文件中标题不一致时，会判定为不同的影片，导致同一部影片在媒体库中存在重复数据的问题。

### 优化
- 扫描媒体库和下载文件转移支持ISO文件格式。
- 优化电视节目下载匹配逻辑，缺失集数和资源索引结果进行由低到高匹配，尽可能避免下载到重复集。

## [2.2.1] - 2025-05-14

### 修复
- 修复媒体目录中不存在NFO文件时扫描不到电影的问题。

### 优化
- 系统设置页面优化，增加设置项提示文字。

## [2.2.0] - 2025-05-13

### 新增
- 新增多站点功能，新增并适配：观影、不太灵影视 两个站点。目前支持私有BT站（需注册账号）：高清剧集网、高清影视之家。免费站点：观影（需注册账号）、不太灵影视

### 修复
- 修复系统仪表读取系统进程时因为某些进程可能没有命令行参数（cmdline），因此psutil返回的cmdline值为None。导致调用len(cmdline) 时抛出了TypeError 导致系统进程列表获取失败的问题。
- 修复热门推荐中“热门剧集”的订阅错误，剧集被错误的当成电影进行订阅。

### 修改
- 修改资源搜索逻辑，将搜索结果保存在索引文件中，由下载程序直接调用搜索结果。
- 修改热门推荐中“订阅”按钮的状态检查，如果影片已订阅或已入库，则改变按钮状态为已订阅或已入库，避免重复订阅。

### 优化
- 优化文件转移时检查现有媒体库文件，如果已存在相同剧集或电影，则删除现有文件并转移新文件，避免媒体库中重复多个版本文件。

## [2.1.3] - 2025-04-30

### 说明
- 本次更新为五一节前最后一次更新，计划节后将开始开发免费站点功能，计划适配：观影、不太灵影视 两个站点。

### 优化
- 正在订阅数据插入数据库时加入豆瓣ID到数据库中，便于后续资源搜索时使用豆瓣ID进行搜索（计划用于免费站点）。

### 修复
- 修复从服务控制中手动运行服务后运行日志被删除的问题。

## [2.1.2] - 2025-04-29

### 优化
- 在线升级时，加载指示器遮罩层被升级窗口遮挡的问题。
- 使用qbittorrent下载器时，任务暂停状态显示为未知的问题。
- 优化Github代理加速，智能选择响应时间最快的代理站点，提高在线升级时拉取新版本的成功率。

## [2.1.1] - 2025-04-27

### 优化
- 优化版本号读取逻辑，版本号不再直接写在程序代码中，通过读取版本文件获取版本号。
- 优化版本统计报告，程序启动后将随机生成一个UUID，并向服务器报告当前程序的UUID和当前版本号（仅用于统计使用情况，程序不会收集任何用户个人数据）。

### 修复
- 修复系统仪表CPU、内存、存储使用情况显示，超80%以上使用率时仪表颜色变为橙色，超90%以上使用率时仪表颜色变为红色，提升用户体验。

## [2.1.0] - 2025-04-24

### 优化
- 调整WEB UI界面样式，页面观感更加美观，提升用户体验。

### 修复
- 修复一些已知问题，提升用户体验。

### 新增
- 上线系统仪表盘统计功能，支持显示当前媒体库中的媒体统计，以及系统硬件资源使用情况、系统进程显示、下载器实时速率显示等。
- 上线TMDB热门推荐功能，支持从推荐中直接添加订阅。（此功能依赖TMDB API接口，网络不可达或API密钥无效时无法正常使用。）

## [2.0.5] - 2025-04-17

### 优化
- 优化部分页面显示效果，提升用户体验。
- 优化在线升级功能处理逻辑，提升用户体验。

## [2.0.4] - 2025-04-16

### 新增
- 新增在线升级功能，支持在线检查程序更新并且进行在线升级（依赖Github Api接口，网络不可达会导致检查更新失败）。

## [2.0.3] - 2025-04-15

### 优化
- 优化下载器管理功能，使用qbittorrent-api和transmission-rpc python库，并且统一前端页面api接口调用，支持qbittorrent和transmission下载器。

### 修复
- 修复一些已知问题，提升用户体验。

### 新增
- 新增下载器管理功能支持用户名密码认证，在系统设置中配置下载器用户名和密码即可（qbittorrent一般需要登录，transmission一般不需要；如果没有用户名密码时配置项保持默认或填写为空即可）。

## [2.0.2] - 2025-04-11

### 优化
- 进一步优化查找种子下载链接的匹配逻辑，增加显式等待和重试机制，减少 `stale element reference` 异常的发生，提高下载成功的概率。

### 修复
- 修复一些已知问题。

### 升级
- 升级Google Chrome浏览器和ChromeDriver版本到135.0.7049.84。

## [2.0.1] - 2025-04-10

### 优化
- 优化查找种子下载链接的匹配逻辑。
- 优化一些其他细节。

## [2.0.0] - 2025-04-08

### 说明
- 本次版本为v2.0.0，基于mediamaster-chromedriver 1.8.1版本改版并重新构建大部分代码，优化了部分功能。

### 注意事项
- 本次更新涉及数据库结构变更、配置文件变更，无法与之前版本兼容以及无损更新，需要重新进行系统配置。

[2.0.0]: https://github.com/smysong/mediamaster-v2/releases/tag/v2.0.0
[2.0.1]: https://github.com/smysong/mediamaster-v2/releases/tag/v2.0.1
[2.0.2]: https://github.com/smysong/mediamaster-v2/releases/tag/v2.0.2
[2.0.3]: https://github.com/smysong/mediamaster-v2/releases/tag/v2.0.3
[2.0.4]: https://github.com/smysong/mediamaster-v2/releases/tag/v2.0.4
[2.0.5]: https://github.com/smysong/mediamaster-v2/releases/tag/v2.0.5
[2.1.0]: https://github.com/smysong/mediamaster-v2/releases/tag/v2.1.0
[2.1.1]: https://github.com/smysong/mediamaster-v2/releases/tag/v2.1.1
[2.1.2]: https://github.com/smysong/mediamaster-v2/releases/tag/v2.1.2
[2.1.3]: https://github.com/smysong/mediamaster-v2/releases/tag/v2.1.3
[2.2.0]: https://github.com/smysong/mediamaster-v2/releases/tag/v2.2.0
[2.2.1]: https://github.com/smysong/mediamaster-v2/releases/tag/v2.2.1
[2.2.2]: https://github.com/smysong/mediamaster-v2/releases/tag/v2.2.2
[2.2.3]: https://github.com/smysong/mediamaster-v2/releases/tag/v2.2.3
[2.2.4]: https://github.com/smysong/mediamaster-v2/releases/tag/v2.2.4
[2.3.0]: https://github.com/smysong/mediamaster-v2/releases/tag/v2.3.0
[2.3.1]: https://github.com/smysong/mediamaster-v2/releases/tag/v2.3.1
[2.3.2]: https://github.com/smysong/mediamaster-v2/releases/tag/v2.3.2
[2.3.3]: https://github.com/smysong/mediamaster-v2/releases/tag/v2.3.3
[2.3.4]: https://github.com/smysong/mediamaster-v2/releases/tag/v2.3.4
[2.3.5]: https://github.com/smysong/mediamaster-v2/releases/tag/v2.3.5
[2.3.6]: https://github.com/smysong/mediamaster-v2/releases/tag/v2.3.6
[2.3.7]: https://github.com/smysong/mediamaster-v2/releases/tag/v2.3.7
[2.3.8]: https://github.com/smysong/mediamaster-v2/releases/tag/v2.3.8
[2.3.9]: https://github.com/smysong/mediamaster-v2/releases/tag/v2.3.9
[2.3.10]: https://github.com/smysong/mediamaster-v2/releases/tag/v2.3.10
[2.3.11]: https://github.com/smysong/mediamaster-v2/releases/tag/v2.3.11
[2.3.12]: https://github.com/smysong/mediamaster-v2/releases/tag/v2.3.12